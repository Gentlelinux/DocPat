{% extends "base.html" %}
{% block title %}{{ title }}{% endblock %}

{% block content %}
    <h2>Willkommen im DocPat Dashboard! ğŸ©º</h2>

    <p>Heute ist der {{ current_date.strftime('%d.%m.%Y') }}.</p> {# Aktuelles Datum anzeigen #}

    <div class="row"> {# Bootstrap Row fÃ¼r Layout #}

        {# Spalte fÃ¼r Suche und Anlegen #}
        <div class="col-md-6"> {# Nimmt 6 von 12 Spalten auf mittelgroÃŸen/groÃŸen Bildschirmen #}
            <h3>Schnellsuche nach Patienten ğŸ”</h3> {# Such-Emoji #}
             {# Patientensuche Formular #}
             {# Die Action fÃ¼hrt zur Patientenliste, die den Suchbegriff aus request.args liest #}
            <form method="GET" action="{{ url_for('bp.patient_list') }}" class="form-inline"> {# METHOD GET fÃ¼r Suche #}
                 {{ patient_search_form.hidden_tag() }} {# CSRF Schutz ist bei GET-Formularen nicht zwingend, aber schadet nicht #}
                <div class="input-group mb-3"> {# Bootstrap Input Gruppe #}
                    {{ patient_search_form.search_term(class="form-control", placeholder="Nach Nachname oder Vorname suchen...") }} {# Bootstrap Form Control #}
                     <button class="btn btn-outline-primary" type="submit">{{ patient_search_form.submit.label }}</button> {# Bootstrap Button #}
                </div>
            </form>

            <br>

            <h3>Neu anlegen âœ¨</h3> {# Anlegen-Emoji #}
            <p>Hier kÃ¶nnen Sie neue EintrÃ¤ge erstellen:</p>
            <ul>
                {# Direkte Links zu Anlegeformularen, die keine sofortige Patientenauswahl brauchen (Patient wird im Formular gewÃ¤hlt oder ist global) #}
                <li><a href="{{ url_for('bp.add_patient') }}">Neuen Patienten anlegen ğŸ§‘â€âš•ï¸</a></li> {# Emoji #}
                <li><a href="{{ url_for('bp.add_appointment_general') }}">Neuen Termin anlegen â°</a></li> {# Emoji #}
                <li><a href="{{ url_for('bp.add_visit_general') }}">Neue Visite/Behandlung anlegen ğŸ“</a></li> {# Emoji #}
                {# NEU: Links zu den Patientenauswahl-Seiten vor dem Anlegen #}
                <li><a href="{{ url_for('bp.add_vaccination_select_patient') }}">Neue Impfung anlegen ğŸ’‰</a></li> {# Emoji #}
                <li><a href="{{ url_for('bp.add_injection_select_patient') }}">Neue Injektion anlegen ğŸ©¸</a></li> {# Emoji #}
                <li><a href="{{ url_for('bp.add_vital_sign_select_patient') }}">Neue Vitalwerte anlegen â¤ï¸</a></li> {# Emoji #}
            </ul>


             <br>

            <h3>Suchen und Reports ğŸ“„ğŸ“Š</h3> {# Emojis #}
            <p>Hier kÃ¶nnen Sie EintrÃ¤ge suchen oder Reports generieren:</p>
            <ul>
                 <li><a href="{{ url_for('bp.patient_list') }}">Alle Patienten anzeigen ğŸ“„</a></li> {# Link zur gesamten Patientenliste #}
                 <li><a href="{{ url_for('bp.list_appointments') }}">TerminÃ¼bersicht anzeigen ğŸ“…</a></li> {# Link zur gesamten TerminÃ¼bersicht #}
                 <li><a href="{{ url_for('bp.list_visits') }}">VisitenÃ¼bersicht anzeigen ğŸ“</a></li> {# Link zur gesamten VisitenÃ¼bersicht #}
                 {# NEU: Explizite Links zu den Reports (die auch als Suchseiten dienen) #}
                 <li><a href="{{ url_for('bp.report_vaccinations_by_patient_date') }}">Impfungen suchen/Report Impfungen ğŸ’‰</a></li> {# Link zum Impf-Report #}
                 <li><a href="{{ url_for('bp.report_injections_by_patient_date') }}">Injektionen suchen/Report Injektionen ğŸ©¸</a></li> {# Link zum Injektions-Report #}
                 <li><a href="{{ url_for('bp.report_vital_signs_by_patient_date') }}">Vitalwerte suchen/Report Vitalwerte â¤ï¸</a></li> {# Link zum Vitalwerte-Report #}
                 {# Link zur Reports-Indexseite, falls es noch andere Reports gibt #}
                 <li><a href="{{ url_for('bp.reports_index') }}">Weitere Reports ğŸ“Š</a></li>
            </ul>


        </div>

        {# Spalte fÃ¼r Ãœbersichtsdaten #}
        <div class="col-md-6"> {# Nimmt 6 von 12 Spalten #}
            <h3>Ãœbersicht âœ¨</h3> {# Emoji #}

            {# Karte fÃ¼r Patientenzahl #}
            <div class="card text-center mb-3"> {# Bootstrap Card #}
                <div class="card-body">
                    <h5 class="card-title">Gesamtzahl Patienten</h5>
                    <p class="card-text display-4">{{ total_patients }}</p> {# GroÃŸe Zahl #}
                </div>
            </div>

            {# Karte fÃ¼r nÃ¤chste Termine #}
            <div class="card mb-3">
                <div class="card-header">
                    NÃ¤chste Termine â°
                </div>
                <ul class="list-group list-group-flush"> {# Bootstrap Liste #}
                    {% if upcoming_appointments %}
                        {% for appointment in upcoming_appointments %}
                            <li class="list-group-item">
                                {{ appointment.date_time.strftime('%d.%m.%Y %H:%M') }}:
                                <a href="{{ url_for('bp.view_patient', patient_id=appointment.patient_id) }}">
                                     {{ appointment.patient.nachname }}, {{ appointment.patient.vorname }}
                                </a> - {{ appointment.description }}
                            </li>
                        {% endfor %}
                    {% else %}
                         <li class="list-group-item">Keine bevorstehenden Termine gefunden.</li>
                    {% endif %}
                </ul>
            </div>

            {# Karte fÃ¼r letzte Visiten #}
            <div class="card mb-3">
                <div class="card-header">
                    Letzte Visiten ğŸ“
                </div>
                 <ul class="list-group list-group-flush">
                    {% if recent_visits %}
                        {% for visit in recent_visits %}
                            <li class="list-group-item">
                                {{ visit.date_time.strftime('%d.%m.%Y %H:%M') }}:
                                <a href="{{ url_for('bp.view_patient', patient_id=visit.patient_id) }}">
                                     {{ visit.patient.nachname }}, {{ visit.patient.vorname }}
                                </a> - {{ visit.assessment | truncate(50) if visit.assessment else 'Keine Beurteilung' }} {# Kurze Beurteilung #}
                            </li>
                        {% endfor %}
                    {% else %}
                         <li class="list-group-item">Keine letzten Visiten gefunden.</li>
                    {% endif %}
                </ul>
            </div>

        </div>

    </div>


{% endblock content %}
